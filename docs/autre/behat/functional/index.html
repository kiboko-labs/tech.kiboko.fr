<!DOCTYPE html>
<html lang="fr-fr">
  <head>
  <meta charset="utf-8">
  <title>Functional</title>

  <meta name="generator" content="Hugo 0.74.3" />

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <!-- ** Plugins Needed for the Project ** -->
  <!-- Bootstrap -->
  <link rel="stylesheet" href="http://tech.kiboko.fr/plugins/bootstrap/bootstrap.min.css">

  <!-- themefy-icon -->
  <link rel="stylesheet" href="http://tech.kiboko.fr/plugins/themify-icons/themify-icons.css">

  <!-- highlight -->
  <link rel="stylesheet" href="http://tech.kiboko.fr/plugins/highlight/hybrid.css">

  <!--Favicon-->
  <link rel="icon" href="http://tech.kiboko.fr/images/favicon.png" type="image/x-icon">

  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css?family=Libre%20Franklin%2c%20Helvetica%20Neue%2c%20Helvetica%2c%20Arial%2c%20Sans-Serif:300,400,700&display=swap" rel="stylesheet">
  
  <style>
  :root{
    --primary-color: #222;
    --body-color:#ddd;
    --text-color:#000;
    --text-color-dark:#333;
    --white-color:#eee;
    --light-color:#ddd;
    --font-family:Libre Franklin, Helvetica Neue, Helvetica, Arial, Sans-Serif;
  }
  </style>

<!-- Main Stylesheet -->

<link href="http://tech.kiboko.fr/css/style.min.css" rel="stylesheet" media="screen"/>

<!-- jquiry -->
<script src="http://tech.kiboko.fr/plugins/jquery/jquery-1.12.4.js"></script>

<!-- jquary ui -->
<script src="http://tech.kiboko.fr/plugins/jquery/jquery-ui.js"></script>

<!-- Bootstrap JS -->
<script src="http://tech.kiboko.fr/plugins/bootstrap/bootstrap.min.js"></script>

<!-- match-height JS -->
<script src="http://tech.kiboko.fr/plugins/match-height/jquery.matchHeight-min.js"></script>

<!-- highlight -->
<script src="http://tech.kiboko.fr/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



</head>
  
  <body>
    
    <!-- header -->
    <header class="shadow-bottom sticky-top bg-white">
      <nav class="navbar navbar-expand-md navbar-light">
  <div class="container">
    <a class="navbar-brand px-2" href="/">
      
      
      
      
      <div class="navbar-brand">
          <img class="img-fluid" src="http://tech.kiboko.fr/images/logo.png" alt="Tech.Kiboko.fr">
          <span class="title">Tech.Kiboko.fr</span>
      </div>
      
      
    </a>
    <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link text-dark" href="/">Accueil</a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link text-dark" href="/kibokast">Kibokast</a>
        </li>
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            docs
          </a>
          <div class="dropdown-menu">
            
            <a class="dropdown-item" href="/oro">Oro</a>
            
            <a class="dropdown-item" href="/docker">Docker</a>
            
            <a class="dropdown-item" href="/autre">Autre</a>
            
          </div>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-dark" href="http://kiboko.fr/fr/contactez-nous/">Contactez-nous</a>
        </li>
        
        
      </ul>
      
    </div>
  </div>
</nav>

    </header>
    <!-- /header -->
    
    

<!-- details page -->
<section class="single section-sm pb-0">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="sidebar">
          <ul class="list-styled">
            
            <a class="back-btn" href="/"></a>
            
              
            
              
            
              
            
              
              








<li data-nav-id="http://tech.kiboko.fr/autre/" title="Autre" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/">
    Autre
  </a>
  
  
    <ul>
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/" title="Behat" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/">
    Behat
  </a>
  
  
    <ul>
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-autoloading/" title="Autoloading" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-autoloading/">
    Autoloading
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-configuration/" title="Configuration" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-configuration/">
    Configuration
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-conventions/" title="Conventions" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-conventions/">
    Conventions
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-elements-form/" title="Elements form" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-elements-form/">
    Elements form
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-exemples/" title="exemples" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-exemples/">
    exemples
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-fixtures/" title="Fixtures" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-fixtures/">
    Fixtures
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/functional/" title="Functional" class="sidelist
  active">
  <a href="http://tech.kiboko.fr/autre/behat/functional/">
    Functional
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/intro/" title="intro" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/intro/">
    intro
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-isolation/" title="Isolation" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-isolation/">
    Isolation
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-symfony/" title="Symfony" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-symfony/">
    Symfony
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/javascript/" title="Test unitaire Javascript" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/javascript/">
    Test unitaire Javascript
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/behat/behat-tips/" title="Tips" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/behat/behat-tips/">
    Tips
  </a>
  
  
</li>


        
      
    </ul>
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/stack-faq/" title="Stack FAQ" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/stack-faq/">
    Stack FAQ
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/git-flow/" title="Git flow" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/git-flow/">
    Git flow
  </a>
  
  
</li>


        
      
        
          








<li data-nav-id="http://tech.kiboko.fr/autre/regex/" title="Regex" class="sidelist
  ">
  <a href="http://tech.kiboko.fr/autre/regex/">
    Regex
  </a>
  
  
</li>


        
      
    </ul>
  
</li>


              
            
              
            
          </ul>
        </div>
      </div>
      <div class="col-lg-9">
        <div class="p-lg-5 p-4 bg-white">
          <h2 class="mb-5 category-title">
              
              Functional
          </h2>
          <p></p>
          
            <p class="post-meta border-bottom pb-3 mb-0 mt-3">01/12/2020</p>
          
          
          <div class="content"><h1 id="tests-fonctionnels">Tests fonctionnels</h1>
<p>Les tests fonctionnels permettent de vérifier l’intégration des différentes couches d’une application.</p>
<p>Dans cet article, vous apprendrez comment vous pouvez améliorer l’expérience de la rédaction de tests fonctionnels avec
Oroplatform. Il est recommandé de lire la <a href="https://symfony.com/doc/4.4/testing.html#functional-tests">Doc Symfony</a>
concernant les tests avant de continuer. Vous devriez également connaître <a href="https://phpunit.de/getting-started/phpunit-9.html">PhpUnit</a></p>
<h2 id="quand-rédiger-les-tests-fonctionnels">Quand rédiger les tests fonctionnels</h2>
<p>Les tests fonctionnels sont généralement rédigés pour les :</p>
<p>Contrôleurs
Commandes
Dépôts
Autres services</p>
<p>L’objectif des tests fonctionnels n’est pas de tester des classes séparées (tests unitaires), mais de tester
l’intégration des différentes parties d’une application.</p>
<p>Ajouter des tests fonctionnels pour compléter les tests unitaires pour les raisons suivantes :</p>
<ul>
<li>Vous pouvez tester le système multi-composants et vous assurer qu’il fonctionne comme un tout.</li>
<li>Vous pouvez éviter la simulation(mocking) de l’interface compliquée ou de la couche de manipulation de données
(comme les classes de doctrine pour construire une requête).
Les tests unitaires peuvent réussir même si les fonctionnalités ne fonctionnent pas correctement.</li>
</ul>
<h2 id="environnement-de-test">Environnement de test</h2>
<h3 id="initialisation-du-client-et-avertissement-quand-aux-chargement-des-fixtures">Initialisation du client et avertissement quand aux chargement des fixtures</h3>
<p>Pour améliorer la performance de l’exécution du test, l’initialisation d’un client n’est effectuée qu’une seule fois par
cas de test par défaut. Cela signifie que le noyau de l’application Symfony sera démarré une fois par cas de test.
Les fixtures sont également chargés une seule fois par cas de test par défaut. D’une part, initialiser et charger
des fixtures une fois par cas de test augmente la performance de l’exécution de test mais peut aussi causer des bugs
car  l’état des fixtures et du noyau (et par conséquent, le conteneur de service) sera partagé par défaut entre les
méthodes de test de cas de test séparés. Assurez-vous de réinitialiser cet état si nécessaire.</p>
<h3 id="configuration-dun-environnement-de-test">Configuration d&rsquo;un environnement de test</h3>
<p>Vous devez configurer les paramètres suivants pour l’environnement de test :</p>
<ol>
<li>
<p>Créer une base de données distincte pour les tests (p. ex., ajouter le suffixe « _test ») :</p>
</li>
<li>
<p>Configurez les paramètres hôte, port et authentification pour la base de données, le serveur de messagerie et le
serveur de socket web dans le fichier parameters_test.yml :</p>
</li>
</ol>
<p>Par exemple :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># config/parameters_test.yml</span>
<span style="color:#66d9ef">parameters</span>:
    <span style="color:#66d9ef">database_host</span>: <span style="color:#ae81ff">127.0.0.1</span>
    <span style="color:#66d9ef">database_port</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">database_name</span>: crm_test
    <span style="color:#66d9ef">database_user</span>: root
    <span style="color:#66d9ef">database_password</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">mailer_transport</span>: smtp
    <span style="color:#66d9ef">mailer_host</span>: <span style="color:#ae81ff">127.0.0.1</span>
    <span style="color:#66d9ef">mailer_port</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">mailer_encryption</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">mailer_user</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">mailer_password</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">session_handler</span>: <span style="color:#66d9ef">null</span>
    <span style="color:#66d9ef">locale</span>: en
    <span style="color:#66d9ef">secret</span>: ThisTokenIsNotSoSecretChangeIt
    <span style="color:#66d9ef">installed</span>: <span style="color:#66d9ef">false</span>
</code></pre></div><ol start="3">
<li>Installez l&rsquo;application dans un environnement de test</li>
</ol>
<pre><code>bin/console oro:install \
 --env=test  \
 --organization-name=Oro \
 --user-name=admin \
 --user-email=admin@example.com \
 --user-firstname=John \
 --user-lastname=Doe \
 --user-password=admin \
 --sample-data=n \
 --application-url=http://localhost
</code></pre><p>Lors de l’installation, la structure de la base de données est configurée et les fixtures standard sont chargés.</p>
<ol start="4">
<li>Exécuter les tests en utilisant phpunit avec l’option –testsuite appropriée (unit ou functionnal).</li>
</ol>
<p>ATTENTION
Actuellement, l’exécution de différents types de tests automatisés ensemble n’est pas prise en charge.
Il est donc fortement déconseillé d’exécuter des tests unitaires et des tests fonctionnels côte à côte en une seule exécution, car cela produit des erreurs.
Les tests unitaires créent des objets fictifs qui interfèrent ultérieurement avec l’exécution des tests fonctionnels
et créent une ambiguïté inutile. Il est possible de désactiver les tests unitaires au démarrage du test à l’aide de l’option testsuite :</p>
<p>$ php bin/phpunit -c . / &ndash;testsuite=functional
$ php bin/phpunit -c . / &ndash;testsuite=unit</p>
<h2 id="database-isolation">Database Isolation</h2>
<p>L&rsquo;annotation @dbIsolationPerTest ajoute une transaction qui sera effectuée avant le début d’un test et qui est annulée lorsqu’un test se termine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

/**
 * @dbIsolationPerTest
 */
class FooBarTest extends WebTestCase
{
    // ...
}
</code></pre></div><h2 id="chargement-des-data-fixtures-">Chargement des data fixtures :</h2>
<p>Utilisez la méthode loadFixtures() pour charger des données dans un test :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected function setUp()
    {
        $this-&gt;initClient(); // must be called before!

        // loading fixtures will be executed once, use the second parameter
        // $force = true to force the loading
        $this-&gt;loadFixtures([
            &#39;Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures\LoadFooData&#39;,
            &#39;@OroFooBarBundle/Tests/Functional/DataFixtures/bar_data.yml&#39;,
        ]);
    }

    // ...
}
</code></pre></div><p>Un fixture doit être soit un nom de classe qui implémente Doctrine\Common\DataFixtures\FixtureInterface , soit un chemin vers le fichier nelmio/alice.</p>
<p>Un exemple de fixture :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBarBundle/Tests/Functional/DataFixtures/LoadFooData.php
namespace Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures;

use Doctrine\Common\DataFixtures\AbstractFixture;
use Doctrine\Common\Persistence\ObjectManager;
use Oro\Bundle\FooBarBundle\Entity\FooEntity;

class LoadFooData extends AbstractFixture
{
    public function load(ObjectManager $manager)
    {
        $entity = new FooEntity();
        $manager-&gt;persist($entity);
        $manager-&gt;flush();
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    <span style="color:#75715e"># src/Oro/Bundle/FooBarBundle/Tests/Functional/DataFixtures/bar_data.yml</span>
    <span style="color:#66d9ef">Oro\Bundle\FooBarBundle\Entity\BarEntity</span>:
        <span style="color:#66d9ef">bar</span>:
            <span style="color:#66d9ef">name</span>: test
</code></pre></div><p>Vous pouvez également implémenter l’interfaceDoctrine\Common\DataFixtures\DependentFixtureInterface qui permet de charger des fixtures en fonction des autres fixtures déjà chargées :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBarBundle/Tests/Functional/DataFixtures/LoadFooData.php
namespace Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures;

use Doctrine\Common\DataFixtures\DependentFixtureInterface;
use Doctrine\Common\DataFixtures\AbstractFixture;
use Doctrine\Common\Persistence\ObjectManager;

class LoadFooData extends AbstractFixture implements DependentFixtureInterface
{
    public function load(ObjectManager $manager)
    {
        // load fixtures
    }

    public function getDependencies()
    {
        return [&#39;Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures\LoadBarData&#39;];
    }
}
</code></pre></div><p>De plus, vous pouvez utiliser des entités spécifiques aux références à partir de fixtures, par exemple :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures;

use Doctrine\Common\Persistence\ObjectManager;
use Doctrine\Common\DataFixtures\DependentFixtureInterface;
use Doctrine\Common\DataFixtures\AbstractFixture;

use Oro\Bundle\FooBarBundle\Entity\FooEntity;

class LoadFooData extends AbstractFixture implements DependentFixtureInterface
{
    public function load(ObjectManager $manager)
    {
        $entity = new FooEntity();
        $manager-&gt;persist($entity);
        $manager-&gt;flush();

        $this-&gt;addReference(&#39;my_entity&#39;, $entity);
    }

    public function getDependencies()
    {
        return [&#39;Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures\LoadBarData&#39;];
    }
}
</code></pre></div><p>Maintenant, vous pouvez référencer le fixture par le nom configuré dans votre test :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected $entity;

    protected function setUp()
    {
        $this-&gt;initClient();
        $this-&gt;loadFixtures(&#39;Oro\Bundle\FooBarBundle\Tests\Functional\DataFixtures\LoadFooData&#39;);
        $this-&gt;entity = $this-&gt;getReference(&#39;my_entity&#39;);
    }

    // ...
}
</code></pre></div><h3 id="notes-">NOTES :</h3>
<ol>
<li>Par défaut, le gestionnaire d’entités est effacé après le chargement de chaque fixture. Pour éviter le nettoyage une fixture peut implémenterOro\Bundle\TestFrameworkBundle\Test\DataFixtures\InitialFixtureInterface.</li>
<li>Parfois, vous avez besoin d’une référence à l’Organization, d&rsquo;un User ou d&rsquo;une BusinessUnit. Les fixtures suivants peuvent être utilisés pour les charger :</li>
</ol>
<ul>
<li>Oro\Bundle\TestFrameworkBundle\Tests\Functional\DataFixtures\LoadOrganization</li>
<li>Oro\Bundle\TestFrameworkBundle\Tests\Functional\DataFixtures\LoadUser</li>
<li>Oro\Bundle\TestFrameworkBundle\Tests\Functional\DataFixtures\LoadBusinessUnit</li>
</ul>
<h2 id="ecrire-des-test-fonctionnel-">Ecrire des test fonctionnel :</h2>
<p>Pour créer un test fonctionel :</p>
<ol>
<li>Etendez la classe WebTestCase</li>
<li>Préparez une instance de la classe Client</li>
<li>Préparez vos fixtures ( Optionnel)</li>
<li>Préparez le container</li>
<li>Appelez les fonctionnalitées du test
6 Vérifiez le résultat</li>
</ol>
<h3 id="tests-fonctionnel-pour-les-controlleurs-">Tests fonctionnel pour les controlleurs :</h3>
<p>Un test fonctionnel pour un contrôleur se compose de quelques étapes:</p>
<ol>
<li>Faire une requete</li>
<li>Tester la réponse</li>
<li>Cliquez sur un lien ou soumettez un formulaire</li>
<li>Test the response</li>
<li>Nettoyer et répéter</li>
</ol>
<h3 id="exemples-de-prépraration-du-client-">Exemples de prépraration du client :</h3>
<p>L’initialisation simple fonctionne pour tester les commandes et les services lorsque l’authentification n’est pas nécessaire.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected function setUp()
    {
        $this-&gt;initClient(); // initialization occurres only once per test class
        // now varialbe $this-&gt;client is available
    }
    // ...
}
</code></pre></div><p>Initialisation avec les options Appkernel personnalisées :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected function setUp()
    {
        // first array is Kernel options
        $this-&gt;initClient([&#39;debug&#39; =&gt; false]);
    }
    // ...
}
</code></pre></div><p>Initialisation avec authentification :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected function setUp()
    {
        // second array is service options
        // this example will create client with server options [&#39;PHP_AUTH_USER&#39; =&gt; &#39;admin@example.com&#39;, &#39;PHP_AUTH_PW&#39; =&gt; &#39;admin&#39;]
        // make sure you loaded fixture with test user
        // bin/console doctrine:fixture:load --no-debug --append --no-interaction --env=test --fixtures src/Oro/src/Oro/Bundle/TestFrameworkBundle/Fixtures
        $this-&gt;initClient([], $this-&gt;generateBasicAuthHeader());

        // init client with custom username and password
        $this-&gt;initClient([], $this-&gt;generateBasicAuthHeader(&#39;custom_username&#39;, &#39;custom_password&#39;));
    }
    // ...
}
</code></pre></div><h2 id="types-de-tests-fonctionnels">Types de tests fonctionnels</h2>
<h3 id="tester-les-controllers">Tester les controllers</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/OroCRM/Bundle/TaskBundle/Tests/Functional/Controller/TaskControllersTest.php
namespace Oro\Bundle\TaskBundle\Tests\Functional\Controller;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

/**
 * @outputBuffering enabled
 */
class TaskControllersTest extends WebTestCase
{
    protected function setUp()
    {
        $this-&gt;initClient([], $this-&gt;generateBasicAuthHeader());
    }

    public function testCreate()
    {
        $crawler = $this-&gt;client-&gt;request(&#39;GET&#39;, $this-&gt;getUrl(&#39;orocrm_task_create&#39;));

        $form = $crawler-&gt;selectButton(&#39;Save and Close&#39;)-&gt;form();
        $form[&#39;orocrm_task[subject]&#39;] = &#39;New task&#39;;
        $form[&#39;orocrm_task[description]&#39;] = &#39;New description&#39;;
        $form[&#39;orocrm_task[dueDate]&#39;] = &#39;2014-03-04T20:00:00+0000&#39;;
        $form[&#39;orocrm_task[owner]&#39;] = &#39;1&#39;;
        $form[&#39;orocrm_task[reporter]&#39;] = &#39;1&#39;;

        $this-&gt;client-&gt;followRedirects(true);
        $crawler = $this-&gt;client-&gt;submit($form);
        $result = $this-&gt;client-&gt;getResponse();
        $this-&gt;assertHtmlResponseStatusCodeEquals($result, 200);
        $this-&gt;assertContains(&#39;Task saved&#39;, $crawler-&gt;html());
    }

    /**
     * @depends testCreate
     */
    public function testUpdate()
    {
        $response = $this-&gt;client-&gt;requestGrid(
            &#39;tasks-grid&#39;,
            [&#39;tasks-grid[_filter][reporterName][value]&#39; =&gt; &#39;John Doe&#39;]
        );

        $result = $this-&gt;getJsonResponseContent($response, 200);
        $result = reset($result[&#39;data&#39;]);

        $crawler = $this-&gt;client-&gt;request(
            &#39;GET&#39;,
            $this-&gt;getUrl(&#39;orocrm_task_update&#39;, [&#39;id&#39; =&gt; $result[&#39;id&#39;]])
        );

        $form = $crawler-&gt;selectButton(&#39;Save and Close&#39;)-&gt;form();
        $form[&#39;orocrm_task[subject]&#39;] = &#39;Task updated&#39;;
        $form[&#39;orocrm_task[description]&#39;] = &#39;Description updated&#39;;

        $this-&gt;client-&gt;followRedirects(true);
        $crawler = $this-&gt;client-&gt;submit($form);
        $result = $this-&gt;client-&gt;getResponse();

        $this-&gt;assertHtmlResponseStatusCodeEquals($result, 200);
        $this-&gt;assertContains(&#39;Task saved&#39;, $crawler-&gt;html());
    }

    /**
     * @depends testUpdate
     */
    public function testView()
    {
        $response = $this-&gt;client-&gt;requestGrid(
            &#39;tasks-grid&#39;,
            [&#39;tasks-grid[_filter][reporterName][value]&#39; =&gt; &#39;John Doe&#39;]
        );

        $result = $this-&gt;getJsonResponseContent($response, 200);
        $result = reset($result[&#39;data&#39;]);

        $this-&gt;client-&gt;request(
            &#39;GET&#39;,
            $this-&gt;getUrl(&#39;orocrm_task_view&#39;, [&#39;id&#39; =&gt; $result[&#39;id&#39;]])
        );
        $result = $this-&gt;client-&gt;getResponse();

        $this-&gt;assertHtmlResponseStatusCodeEquals($result, 200);
        $this-&gt;assertContains(&#39;Task updated - Tasks - Activities&#39;, $result-&gt;getContent());
    }

    /**
     * @depends testUpdate
     */
    public function testIndex()
    {
        $this-&gt;client-&gt;request(&#39;GET&#39;, $this-&gt;getUrl(&#39;orocrm_task_index&#39;));
        $result = $this-&gt;client-&gt;getResponse();
        $this-&gt;assertHtmlResponseStatusCodeEquals($result, 200);
        $this-&gt;assertContains(&#39;Task updated&#39;, $result-&gt;getContent());
    }
}
</code></pre></div><h3 id="tester-les-acls-dans-les-controlleurs-">Tester les ACLs dans les controlleurs :</h3>
<p>Dans cet exemple, un utilisateur sans autorisations suffisantes essaie d’accéder à une action du contrôleur. La méthode assertHtmlResponseStatusCodeEquals()
est utilisée pour s’assurer que l’accès à la ressource demandée est refusé à l’utilisateur :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace Oro\Bundle\UserBundle\Tests\Functional;

use Oro\Bundle\UserBundle\Tests\Functional\DataFixtures\LoadUserData;
use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

/**
 * @outputBuffering enabled
 */
class UsersTest extends WebTestCase
{
    protected function setUp()
    {
        $this-&gt;initClient();
        $this-&gt;loadFixtures([&#39;Oro\Bundle\UserBundle\Tests\Functional\API\DataFixtures\LoadUserData&#39;]);
    }

    public function testUsersIndex()
    {
        $this-&gt;client-&gt;request(
            &#39;GET&#39;,
            $this-&gt;getUrl(&#39;oro_user_index&#39;),
            [],
            [],
            $this-&gt;generateBasicAuthHeader(LoadUserData::USER_NAME, LoadUserData::USER_PASSWORD)
        );
        $result = $this-&gt;client-&gt;getResponse();
        $this-&gt;assertHtmlResponseStatusCodeEquals($result, 403);
    }

    public function testGetUsersAPI()
    {
        $this-&gt;client-&gt;request(
            &#39;GET&#39;,
            $this-&gt;getUrl(&#39;oro_api_get_users&#39;),
            [&#39;limit&#39; =&gt; 100],
            [],
            $this-&gt;generateWsseAuthHeader(LoadUserData::USER_NAME, LoadUserData::USER_API_KEY)
        );
        $result = $this-&gt;client-&gt;getResponse();
        $this-&gt;assertJsonResponseStatusCodeEquals($result, 403);
    }
}
</code></pre></div><p>Voici un exemple de fixture qui ajoute un utilisateur sans permission :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">/ src/Oro/Bundle/UserBundle/Tests/Functional/DataFixtures/LoadUserData.php
namespace Oro\Bundle\UserBundle\Tests\Functional\DataFixtures;

use Doctrine\Common\DataFixtures\AbstractFixture;
use Doctrine\Common\Persistence\ObjectManager;

use Symfony\Component\DependencyInjection\ContainerAwareInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

use Oro\Bundle\UserBundle\Entity\Role;
use Oro\Bundle\UserBundle\Entity\UserApi;

class LoadUserData extends AbstractFixture implements ContainerAwareInterface
{
    const USER_NAME     = &#39;user_wo_permissions&#39;;
    const USER_API_KEY  = &#39;user_api_key&#39;;
    const USER_PASSWORD = &#39;user_password&#39;;

    private $container;

    public function setContainer(ContainerInterface $container = null)
    {
        $this-&gt;container = $container;
    }

    public function load(ObjectManager $manager)
    {
        /** @var \Oro\Bundle\UserBundle\Entity\UserManager $userManager */
        $userManager = $this-&gt;container-&gt;get(&#39;oro_user.manager&#39;);

        // Find role for user to able to authenticate in test.
        // You can use any available role that you want dependently on test logic.
        $role = $manager-&gt;getRepository(Role::class)
            -&gt;findOneBy([&#39;role&#39; =&gt; &#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;]);

        // Creating new user
        $user = $userManager-&gt;createUser();

        // Creating API entity for user, we will reference it in testGetUsersAPI method,
        // if you are not going to test API you can skip it
        $api = new UserApi();
        $api-&gt;setApiKey(self::USER_API_KEY)
            -&gt;setUser($user);

        // Creating user
        $user
            -&gt;setUsername(self::USER_NAME)
            -&gt;setPlainPassword(self::USER_PASSWORD) // This value is referenced in testUsersIndex method
            -&gt;setFirstName(&#39;Simple&#39;)
            -&gt;setLastName(&#39;User&#39;)
            -&gt;addRole($role)
            -&gt;setEmail(&#39;test@example.com&#39;)
            -&gt;setApi($api)
            -&gt;setSalt(&#39;&#39;);

        // Handle password encoding
        $userManager-&gt;updatePassword($user);

        $manager-&gt;persist($user);
        $manager-&gt;flush();
    }
}
</code></pre></div><h3 id="tester-les-commandes-">Tester les commandes :</h3>
<p>Lorsque Oroplatform est installé, vous pouvez tester les commandes en utilisant la méthode runCommand()
de la classe WebTestCase. Cette méthode exécute une commande avec des paramètres donnés et retourne sa sortie
sous forme de chaîne. Par exemple, voyez à quoi ressemble le test pour la classe UpdateSchemaDoctrineListener du SearchBundle :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace Oro\Bundle\SearchBundle\Tests\Functional\EventListener;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class UpdateSchemaListenerTest extends WebTestCase
{
    protected function setUp()
    {
        $this-&gt;initClient();
    }

    /**
     * @dataProvider commandOptionsProvider
     */
    public function testCommand($commandName, array $params, $expectedContent)
    {
        $result = $this-&gt;runCommand($commandName, $params);
        $this-&gt;assertContains($expectedContent, $result);
    }

    public function commandOptionsProvider()
    {
        return [
            &#39;otherCommand&#39; =&gt; [
                &#39;commandName&#39;     =&gt; &#39;doctrine:mapping:info&#39;,
                &#39;params&#39;          =&gt; [],
                &#39;expectedContent&#39; =&gt; &#39;OK&#39;
            ],
            &#39;commandWithoutOption&#39; =&gt; [
                &#39;commandName&#39;     =&gt; &#39;doctrine:schema:update&#39;,
                &#39;params&#39;          =&gt; [],
                &#39;expectedContent&#39; =&gt; &#39;Please run the operation by passing one - or both - of the following options:&#39;
            ],
            &#39;commandWithAnotherOption&#39; =&gt; [
                &#39;commandName&#39;     =&gt; &#39;doctrine:schema:update&#39;,
                &#39;params&#39;          =&gt; [&#39;--dump-sql&#39; =&gt; true],
                &#39;expectedContent&#39; =&gt; &#39;ALTER TABLE&#39;
            ],
            &#39;commandWithForceOption&#39; =&gt; [
                &#39;commandName&#39;     =&gt; &#39;doctrine:schema:update&#39;,
                &#39;params&#39;          =&gt; [&#39;--force&#39; =&gt; true],
                &#39;expectedContent&#39; =&gt; &#39;Schema update and create index completed&#39;
            ]
        ];
    }
}
</code></pre></div><h3 id="voir-aussi">VOIR AUSSI</h3>
<p>Lisez les <a href="https://symfony.com/doc/master/components/console/introduction.html#testing-commands">Test des commandes</a>
dans la documentation officielle pour plus d’informations sur la façon de tester les commandes dans une application Symfony.</p>
<h3 id="tester-les-services-ou-les-repositories">Tester les services ou les Repositories</h3>
<p>Pour tester des services ou des dépôts, vous pouvez accéder au conteneur de service via la méthode getContainer() :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// src/Oro/Bundle/FooBarBundle/Tests/Functional/FooBarTest.php
namespace Oro\Bundle\FooBarBundle\Tests\Functional;

use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class FooBarTest extends WebTestCase
{
    protected $repositoryOrService;

    protected function setUp()
    {
        $this-&gt;initClient();
        $this-&gt;loadFixtures([&#39;Oro\Bundle\FooBarBundle\Tests\Functional\API\DataFixtures\LoadFooBarData&#39;]);
        $this-&gt;repositoryOrService = $this-&gt;getContainer()-&gt;get(&#39;repository_or_service_id&#39;);
    }

    public function testMethod($commandName, array $params, $expectedContent)
    {
        $expected = &#39;test&#39;;
        $this-&gt;assertEquals($expected, $this-&gt;repositoryOrService-&gt;callTestMethod());
    }
</code></pre></div><h2 id="example-de-test-fonctionnel-">Example de test fonctionnel :</h2>
<p>Ceci est un exemple de la façon dont vous pouvez écrire un test d’intégration pour une classe qui utilise l’ORM de doctrine
sans moquer ses classes et en utilisant de vrais services de Doctrine :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace Oro\Bundle\BatchBundle\Tests\Functional\ORM\QueryBuilder;

use Doctrine\ORM\Query\Expr\Join;
use Doctrine\ORM\QueryBuilder;
use Doctrine\ORM\EntityManager;
use Oro\Bundle\BatchBundle\ORM\QueryBuilder\CountQueryBuilderOptimizer;
use Oro\Bundle\TestFrameworkBundle\Test\WebTestCase;

class CountQueryBuilderOptimizerTest extends WebTestCase
{
    /**
     * @dataProvider getCountQueryBuilderDataProvider
     * @param QueryBuilder $queryBuilder
     * @param string $expectedDql
     */
    public function testGetCountQueryBuilder(QueryBuilder $queryBuilder, $expectedDql)
    {
        $optimizer = new CountQueryBuilderOptimizer();
        $countQb = $optimizer-&gt;getCountQueryBuilder($queryBuilder);
        $this-&gt;assertInstanceOf(&#39;Doctrine\ORM\QueryBuilder&#39;, $countQb);
        // Check for expected DQL
        $this-&gt;assertEquals($expectedDql, $countQb-&gt;getQuery()-&gt;getDQL());
        // Check that Optimized DQL can be converted to SQL
        $this-&gt;assertNotEmpty($countQb-&gt;getQuery()-&gt;getSQL());
    }

    /**
     * @return array
     */
    public function getCountQueryBuilderDataProvider()
    {
        self::initClient();
        $em = self::getContainer()-&gt;get(&#39;doctrine.orm.entity_manager&#39;);

        return [
            &#39;simple&#39; =&gt; [
                &#39;queryBuilder&#39; =&gt; self::createQueryBuilder($em)
                    -&gt;from(&#39;OroUserBundle:User&#39;, &#39;u&#39;)
                    -&gt;select([&#39;u.id&#39;, &#39;u.username&#39;]),
                &#39;expectedDQL&#39; =&gt; &#39;SELECT u.id FROM OroUserBundle:User u&#39;
            ],
            &#39;group_test&#39; =&gt; [
                &#39;queryBuilder&#39; =&gt; self::createQueryBuilder($em)
                    -&gt;from(&#39;OroUserBundle:User&#39;, &#39;u&#39;)
                    -&gt;select([&#39;u.id&#39;, &#39;u.username as uName&#39;])
                    -&gt;groupBy(&#39;uName&#39;),
                &#39;expectedDQL&#39; =&gt; &#39;SELECT u.id, u.username as uName FROM OroUserBundle:User u GROUP BY uName&#39;
            ]
        );
    }

    /**
     * @param EntityManager $entityManager
     * @return QueryBuilder
     */
    public static function createQueryBuilder(EntityManager $entityManager)
    {
        return new QueryBuilder($entityManager);
    }
}
</code></pre></div><h3 id="attention">Attention</h3>
<p>Si votre classe est responsable de la récupération des données, il est préférable de charger les fixtures et de les récupérer
en utilisant une classe de test, puis d’affirmer que les résultats sont valides. Vérifier le DQL suffit dans ce cas car c’est la seule responsabilité de cette classe de modifier la requête.</p>
</div>
          
          <nav class="pagination mt-3">
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            

            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            

            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            

            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            
            
            

            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            
            
            
            
            
            
            
            

            
            
            

            
            
            
            
            
            
            

            
            <a class="nav nav-prev" href="http://tech.kiboko.fr/autre/behat/behat-fixtures/"><i class="ti-arrow-left mr-2"></i> <span class="d-none d-md-block">Fixtures</span></a>
            
            
            <a class="nav nav-next" href="http://tech.kiboko.fr/autre/behat/intro/"> <span class="d-none d-md-block">intro</span><i class="ti-arrow-right ml-2"></i></a>
            
          </nav>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- /details page -->









    <!-- footer -->
<footer class="section pb-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8 text-md-left text-center">
        <!-- legal notice -->
          <a href="/legal-notice">
            <p class="mb-md-0 mb-4">Mentions légales</p>
          </a>
        <!-- /legal notice -->
      </div>
      <div class="col-md-4 text-md-right text-center">
        <ul class="list-inline list-social">
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="https://twitter.com/kibokolabs"><i class="ti-twitter-alt"></i></a></li>
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="https://github.com/kiboko-labs"><i class="ti-github"></i></a></li>
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="https://www.linkedin.com/company/kiboko-sas"><i class="ti-linkedin"></i></a></li>
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="http://kiboko.fr/fr/"><i class="ti-wordpress"></i></a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- /footer -->

<!-- Main Script -->

<script src="http://tech.kiboko.fr/js/script.min.js"></script>

  </body>

</html>